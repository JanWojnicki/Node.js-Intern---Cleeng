Event-Driven Notification Orchestrator
This service handles user notification preferences for events generated by a SaaS product. It provides a simple API to manage user settings and decides whether a notification should be sent for a given event based on those settings.

This project fulfills all core requirements, including the "Do Not Disturb" logic, and also implements the following bonus features:

Input Validation: All POST endpoints use the zod library to validate incoming data, ensuring robustness and data integrity.

Unit Testing: The critical "Do Not Disturb" (DND) logic is thoroughly tested using Jest to guarantee correctness, especially for edge cases like overnight time windows.

ðŸš€ Getting Started
Prerequisites
Node.js (v18 or later recommended)

npm (usually comes with Node.js)

1. Installation
Clone the repository and install the dependencies:

git clone <repository-url>
cd notification-orchestrator
npm install

2. Running the Application
You can run the server in two modes:

A) Development Mode

This uses nodemon to automatically restart the server whenever you make changes to the code.

npm run dev

B) Production Mode

This builds the TypeScript code into JavaScript and then runs the compiled application.

npm run build
npm start

Once started, the server will be running at http://localhost:3000.

3. Running Unit Tests
To run the Jest unit tests for the DND logic, use the following command:

npm test

You will see a pass/fail summary for all test cases in your terminal.

ðŸ“– API Documentation
Manage Preferences
POST /preferences/:userId
Saves or updates the notification preferences for a specific user.

URL Params: userId=[string] (e.g., usr_123)

Body (raw/json):

{
  "dnd": {
    "start": "22:00",
    "end": "07:00"
  },
  "eventSettings": {
    "item_shipped": { "enabled": true },
    "invoice_generated": { "enabled": false }
  }
}

Success Response (200 OK): { "message": "Preferences updated successfully." }

Error Response (400 Bad Request): If the body format is invalid.

GET /preferences/:userId
Retrieves the saved preferences for a specific user.

URL Params: userId=[string]

Success Response (200 OK): The user's preference object.

Error Response (404 Not Found): If no preferences are found for the user.

Process Events
POST /events
Receives an event and decides if a notification should be sent based on user preferences.

Body (raw/json):

{
  "eventId": "evt_abcde",
  "userId": "usr_123",
  "eventType": "item_shipped",
  "timestamp": "2025-09-13T23:00:00Z"
}

Response Scenarios:

202 Accepted: The notification should be sent.

{ "decision": "PROCESS_NOTIFICATION" }

200 OK: The notification should not be sent. The reason is provided.

// DND is active
{ "decision": "DO_NOT_NOTIFY", "reason": "DND_ACTIVE" }

// User is unsubscribed
{ "decision": "DO_NOT_NOTIFY", "reason": "USER_UNSUBSCRIBED_FROM_EVENT" }

Error Response (400 Bad Request): If the event format is invalid.

ðŸ§ª How to Test with Postman
Hereâ€™s a step-by-step guide to testing the endpoints using Postman.

1. Set User Preferences
First, you need to create preferences for a user before you can test the event logic.

Create a new request in Postman.

Set the request type to POST.

Enter the URL: http://localhost:3000/preferences/usr_abcde

Go to the Body tab, select raw, and choose JSON from the dropdown.

Paste the following JSON into the body:

{
  "dnd": {
    "start": "22:00",
    "end": "07:00"
  },
  "eventSettings": {
    "item_shipped": {
      "enabled": true
    },
    "invoice_generated": {
      "enabled": false
    }
  }
}

Click Send. You should get a 200 OK status and a success message.

2. Get User Preferences
Now, let's verify that the preferences were saved correctly.

Create a new request.

Set the request type to GET.

Enter the URL: http://localhost:3000/preferences/usr_abcde

Click Send. You should get a 200 OK status and the JSON object you just saved.

3. Process Events
This is where you can test the different scenarios by using different JSON bodies:

Scenario A: Notification Allowed
(Timestamp is outside DND, and the user is subscribed)

{
  "eventId": "evt_123",
  "userId": "usr_abcde",
  "eventType": "item_shipped",
  "timestamp": "2025-07-28T21:30:00Z"
}

Expected Result: Status 202 Accepted and {"decision": "PROCESS_NOTIFICATION"}.

Scenario B: Notification Blocked by DND
(Timestamp is inside the 22:00-07:00 DND window)

{
  "eventId": "evt_456",
  "userId": "usr_abcde",
  "eventType": "item_shipped",
  "timestamp": "2025-07-28T23:00:00Z"
}

Expected Result: Status 200 OK and {"decision": "DO_NOT_NOTIFY", "reason": "DND_ACTIVE"}.

Scenario C: Notification Blocked by User Preference
(The user has invoice_generated disabled)

{
  "eventId": "evt_789",
  "userId": "usr_abcde",
  "eventType": "invoice_generated",
  "timestamp": "2025-07-28T15:00:00Z"
}

Expected Result: Status 200 OK and {"decision": "DO_NOT_NOTIFY", "reason": "USER_UNSUBSCRIBED_FROM_EVENT"}.